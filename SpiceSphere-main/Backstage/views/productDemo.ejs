<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="/productSection.css">
    <script src="/Backstage/jquery/jquery-3.7.1.min.js"></script>
</head>

<script>
    window.onload = () => {
        let currentPage = 1;
        const cardsPerPage = 12;
        let filteredCards; // 符合條件的圖卡

        function multipleSelect() {
            // 將一些宣告搬出迴圈
            let checkedValues = $('.checkboxContainer input[type="checkbox"]:checked').map(function () {
                return $(this).val();
            }).get();
            let searchTerm = $('#searchTerm').val();
            let maxPrice = $('#priceRange').val()
            $('#maxPrice').text(maxPrice)


            filteredCards = $('.card').filter(function () {
                let card = $(this);
                let isVisible = true;

                // 搜尋功能
                let cardName = card.find('.cardName').text().trim();
                if (searchTerm && !cardName.includes(searchTerm)) {
                    isVisible = false;
                }
                // 搜尋功能

                // 價格範圍
                if (isVisible) {
                    let cardPrice = parseInt(card.find('.cardPrice').text())
                    if (maxPrice < cardPrice) {
                        isVisible = false;
                    }
                }
                // 價格範圍

                // 分類功能
                if (isVisible && checkedValues.length > 0) {
                    let cardClass = card.attr('value').split(',').map(nospace => nospace.trim());
                    if (!cardClass.some(inc => checkedValues.includes(inc))) {
                        isVisible = false;
                    }
                }
                // 分類功能

                return isVisible
            });
            currentPage = 1;
            displayCards();
        }

        function displayCards() {
            $('.card').hide();
            let startIndex = (currentPage - 1) * cardsPerPage;
            let endIndex = startIndex + cardsPerPage;
            filteredCards.slice(startIndex, endIndex).show();
            pageChangeBtn();
        }

        // 分頁標籤
        function pageChangeBtn() {
            let pageCount = Math.ceil(filteredCards.length / cardsPerPage);
            // $('.pageChangeBtn').empty();
            let str = "";

            str += `<li><button class="pageBtn" data-page="1">1</button></li>`;

            if (currentPage > 3) {
                str += `<li>...</li>`;
            }

            for (let i = Math.max(2, currentPage - 1); i <= Math.min(pageCount - 1, currentPage + 1); i++) {
                str += `<li><button class="pageBtn" data-page="${i}">${i}</button></li>`;
            }

            if (currentPage < pageCount - 2) {
                str += `<li>...</li>`;
            }

            if (pageCount > 1) {
                str += `<li><button class="pageBtn" data-page="${pageCount}">${pageCount}</button></li>`;
            }

            $('.pageChangeBtn').html(`${str}`)
            
            $('.pageBtn').on('click', function () {
                console.log($(this).data('page'));
                currentPage = parseInt($(this).data('page'));
                displayCards();
                $('html, body').animate({
                    scrollTop: $('#mainSection').offset().top
                }, 1000);
            })
        }
        // /分頁標籤

        filteredCards = $('.card');
        displayCards();

        $('#search').on('click', multipleSelect);
        $('#priceRange').on('input', multipleSelect);
        $('.checkboxContainer input[type="checkbox"]').on('change', multipleSelect);
    }
</script>

<body>
    <!-- 上方大圖 -->
    <div id="sloganSection">
        <div>
            <p>COOKING</p>
            <p>
                High-quality cooking wear, such as non-stick pans and stainless steel
                pots, enhances the culinary experience by providing durability, even
                heat distribution, and easy cleanup.
            </p>
        </div>
    </div>
    <!-- /上方大圖 -->

    <div id="mainSection">
        <!-- 搜尋區 -->
        <div id="mainSectionSearch">
            <div class="searchBar">
                <input id="searchTerm" type="text" placeholder="搜尋" />
                <button id="search">搜索</button>
            </div>
            <div>
                <div class="mainSectionSearchTitle">價格</div>

                <div class="rangeLabels">
                    <span>0</span>
                    <span id="maxPrice">5000</span>
                </div>
                <input id="priceRange" class="rangeContainer" type="range" min="1000" max="10000" step="1000" />
            </div>
            <div class="mainSectionSearchTitle">用途</div>
            <div class="checkboxContainer">
                <div>
                    <input type="checkbox" id="food" value="食材" /><label for="food">食材</label>
                    <input type="checkbox" id="seasoning" value="調味料" /><label for="seasoning">調味料</label>
                    <input type="checkbox" id="package" value="調理包" /><label for="package">調理包</label>
                </div>
                <div>
                    <input type="checkbox" id="spoon" value="調羹" /><label for="spoon">調羹</label>
                    <input type="checkbox" id="cookware" value="鍋具" /><label for="cookware">鍋具</label>
                    <input type="checkbox" id="cleaning" value="清潔用品" /><label for="cleaning">清潔用品</label>
                </div>
            </div>
            <div class="mainSectionSearchTitle">評分</div>
            <hr />
            <input class="rangeContainer" type="range" min="1" max="5" step="0.5" />
        </div>
        <!-- 搜尋區 -->

        <!-- 商品欄 -->
        <div id="mainSectionProductCards">
            <% items.forEach(function(product) { %>
                <div id="<%= product.product_uid %>" class="card" value="<%= product.related_name %>">
                    <a href="">
                        <div class="cardImg"><img src="/../img/product/product<%= product.product_uid %>.jpg" /></div>
                        <div class="cardName">
                            <%= product.product_title %>
                        </div>
                        <div class="cardPrice">
                            <%= product.price %>
                        </div>
                        <hr />
                    </a>
                    <div class="cardBtn">
                        <button>
                            <?xml version="1.0" encoding="UTF-8"?>
                            <svg width="24px" height="24px" viewBox="0 0 24 24" stroke-width="1.5" fill="none"
                                xmlns="http://www.w3.org/2000/svg" color="#000000">
                                <path
                                    d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z"
                                    stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                                <path
                                    d="M22 17.2798C22 17.8812 21.7625 18.4588 21.3383 18.8861C20.3619 19.8701 19.415 20.8961 18.4021 21.8443C18.17 22.0585 17.8017 22.0507 17.5795 21.8268L14.6615 18.8861C13.7795 17.9972 13.7795 16.5623 14.6615 15.6734C15.5522 14.7758 17.0032 14.7758 17.8938 15.6734L17.9999 15.7803L18.1059 15.6734C18.533 15.2429 19.1146 15 19.7221 15C20.3297 15 20.9113 15.2428 21.3383 15.6734C21.7625 16.1007 22 16.6784 22 17.2798Z"
                                    stroke="#000000" stroke-width="1.5" stroke-linejoin="round"></path>
                                <path d="M5 20V19C5 15.134 8.13401 12 12 12C13.0736 12 14.0907 12.2417 15 12.6736"
                                    stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                            </svg>
                        </button>

                        <button>
                            <?xml version="1.0" encoding="UTF-8"?>
                            <svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg" color="#000000">
                                <path d="M19.5 22C20.3284 22 21 21.3284 21 20.5C21 19.6716 20.3284
                 19 19.5 19C18.6716 19 18 19.6716 18 20.5C18 21.3284 18.6716 22 19.5 
                 22Z" fill="#000000" stroke="#000000" stroke-width="1.5" stroke-linecap="round"
                                    stroke-linejoin="round">
                                </path>
                                <path d="M9.5 22C10.3284 22 11 21.3284 11 20.5C11 
                 19.6716 10.3284 19 9.5 19C8.67157 19 8 19.6716 8 20.5C8 21.3284 8.67157 22 9.5 22Z" fill="#000000"
                                    stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                                <path d="M5 4H22L20 15H7L5 4ZM5 4C4.83333 3.33333 4 2 2 2" stroke="#000000"
                                    stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M20 15H7H5.23077C3.44646 
                 15 2.5 15.7812 2.5 17C2.5 18.2188 3.44646 19 5.23077 19H19.5" stroke="#000000" stroke-width="1.5"
                                    stroke-linecap="round" stroke-linejoin="round">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
                <% }); %>
        </div>
        <!-- /商品欄 -->
    </div>

    <!-- 換頁 -->
    <div id="pageChange">
        <ul class="pageChangeBtn">
        </ul>
    </div>
</body>

</html>